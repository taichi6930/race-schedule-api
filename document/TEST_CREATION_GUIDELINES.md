# テスト作成ガイドライン

このリポジトリでテストを作成するときのルールを示します。以降、新しいテストを追加する際は必ずこの手順に従ってください。

## ルール要約
- テストファイルの先頭に「ディシジョンテーブル（Decision Table）」を必ず記載する。
 - そのディシジョンテーブルを元に、各ケースを網羅する単体テストを作成する。

## ディシジョンテーブルの形式（テンプレート）
ファイルの先頭に以下のような Markdown テーブル形式で記載してください。

| ケースID | 入力 | サービス/リポジトリの挙動 | 期待結果 | 備考 |
|---|---|---|---|---|
| C1 | `[]` | リポジトリに `[]` を渡す | 空配列を返す | 境界値 |
| C2 | `[TYPE_A]` | 対象データを返す | その配列を返す | 単一ヒット |
| C3 | `[TYPE_A,TYPE_B]` | 複数データを返す | 返ってきた配列を返す | マルチヒット |

※ カラムは必要に応じて拡張してください（例: 前提条件、期待される副作用など）。

## テスト作成手順
1. まずディシジョンテーブルを作成し、テストファイル先頭に貼る。レビュアーが仕様を一目で確認できるようにする。  
2. 各ケースに対して1つ以上の `it` ブロック（または適切なサブケース）を追加する。  
3. モックやスタブを使う場合は、テーブルの「リポジトリの挙動」欄に合わせて設定する。  
4. テストは `pnpm --filter @race-schedule/api test -- --run` のように非 watch モードで実行して成功することを確認する。  
5. 追加したテストファイルは `test/` 配下に置き、既存の import alias 問題を避けるため必要なら相対パスを利用するか `vitest.config.ts` の alias を更新する。  

## 例: ファイル冒頭の最小テンプレート
```ts
/*
 | ケースID | 入力 | リポジトリの挙動 | 期待結果 |
 |---|---:|---|---|
 | C1 | `[]` | `[]` を返す | `[]` を返す |
 */
```

## 注意事項
- エラー伝播や例外の扱いは必ずディシジョンテーブルで明示する（例: サービスは例外を伝播する／捕捉してデフォルト値を返す、など）。
- 既存のスタイルや lint ルールに従うこと。必要であれば ESLint 設定の微調整を提案してください。

---
このガイドに沿ってテストを作成してください。運用上の補足や変更があればこのドキュメントを修正します。
